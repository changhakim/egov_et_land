<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bit_etland.web.prod.ProductMapper">

	<resultMap id="result" type="hashmap">
  	<id property="productID" column="PRODUCT_ID" />
  	<result property="productName" column="PRODUCT_NAME"/>
  	<result property="supplierID" column="SUPPLIER_ID"/>
  	<result property="categoryID" column="CATEGORY_ID"/>
  	<result property="unit" column="UNIT"/>
  	<result property="price" column="PRICE"/>
	</resultMap>
	<select id="selectProduct" resultType="com.bit_etland.web.prod.Product">
	  SELECT PRODUCT_ID productID,  
	  	PRODUCT_NAME productName, 
        SUPPLIER_ID supplierID, 
        CATEGORY_ID categoryID,
        UNIT,
        PRICE
      FROM PRODUCTS
	  WHERE PRODUCT_ID LIKE #{productID}

	</select>
	<select id="selectProducts" resultMap="result" 
	parameterType="com.bit_etland.web.cmm.Proxy">
	  SELECT P.*
	  FROM (SELECT @ROWNUM:=@ROWNUM+1 as no,T.*
	  		 FROM(SELECT @ROWNUM:=@ROWNUM+1 as no1, a.*
	  		 		FROM (SELECT C.*
	  		  		 		FROM PRODUCTS C
			  		 		WHERE (@ROWNUM:=0)=0)a)T
	  		WHERE (@ROWNUM:=0)=0	  		 
	  		ORDER BY no1 DESC)P
	  WHERE no BETWEEN #{startRow} AND #{endRow};
  	
	</select>
	<select id="searchProducts" resultType="com.bit_etland.web.prod.Product" 
	parameterType="com.bit_etland.web.cmm.Proxy">
	SELECT R.*
	FROM (SELECT DISTINCT @rownum:=@rownum+1 as color,
					P.PRODUCT_ID productID,
					P.PRODUCT_NAME productName,
					S.SUPPLIER_NAME supplierID,
					C.CATEGORY_NAME categoryID,
					P.UNIT,
					P.PRICE
	FROM PRODUCTS P JOIN SUPPLIERS S ON P.SUPPLIER_ID LIKE S.SUPPLIER_ID
					 JOIN CATEGORIES C ON P.CATEGORY_ID LIKE C.CATEGORY_ID,(SELECT @rownum:=0) AS a
	WHERE CONCAT(PRODUCT_ID,PRODUCT_NAME,SUPPLIER_NAME,CATEGORY_NAME,UNIT,PRICE)LIKE #{searchWord})R
WHERE color BETWEEN #{startRow} AND #{endRow};	
	
	 
  	
	</select>
	<select id="countProducts" resultType="Integer">
	  SELECT COUNT(*)
  	  FROM PRODUCTS	  
	</select>
	<select id="countSearchProducts" resultType="Integer" parameterType="string">
	  SELECT DISTINCT COUNT(*)
	  FROM PRODUCTS P JOIN SUPPLIERS S ON P.SUPPLIER_ID LIKE S.SUPPLIER_ID
					 JOIN CATEGORIES C ON P.CATEGORY_ID LIKE C.CATEGORY_ID
	  WHERE CONCAT(PRODUCT_ID,PRODUCT_NAME,SUPPLIER_NAME,CATEGORY_NAME,UNIT,PRICE)LIKE #{value}  
	</select>
	<insert
		 id="insertProduct" 
		 parameterType="com.bit_etland.web.prod.Product" 
		 flushCache="true"
		 statementType="PREPARED"
		 timeout="20">
	  INSERT INTO PRODUCTS(PRODUCT_NAME,
	  						SUPPLIER_ID,
	  						CATEGORY_ID,
	  						UNIT,
	  						PRICE)
	VALUES(#{productName},
		   #{supplierID},
		   #{categoryID},
		   #{unit},
		   #{price});
 
 </insert>
  
</mapper>